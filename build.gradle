plugins {
    id 'java'
    id 'io.qameta.allure' version '2.12.0'
}

group = 'org.example'
version = '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

configurations {
    testCompile
}

dependencies {
    implementation("ch.qos.logback:logback-classic:1.5.10")
    implementation("io.qameta.allure:allure-testng:2.28.0")

    testImplementation("org.testng:testng:7.10.0")
}

test {
    useTestNG() {
        parallel = getEnvOrProperty("PARALLEL_MODE", "methods")
        threadCount = getEnvOrProperty("THREAD_COUNT", "4").toInteger()
        includeGroups = getGroups("INCLUDE_GROUPS", "ALL")
        excludeGroups = getGroups("EXCLUDE_GROUPS", "EXCLUDE")
    }
}

private static String getEnvOrProperty(String key, String defaultValue) {
    return System.getenv(key)
            ?: System.getProperty(key.toLowerCase().replace('_', '.'))
            ?: defaultValue
}

private static Set<String> getGroups(String key, String defaultValue) {
    String groups = getEnvOrProperty(key, null)
    return groups ? Set.of(groups.split(',')) : Set.of(defaultValue)
}

